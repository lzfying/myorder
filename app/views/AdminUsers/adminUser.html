<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="@{'/public/jquery-easyui/themes/easyui.css'}">
<link rel="stylesheet" type="text/css" href="@{'/public/jquery-easyui/themes/icon.css'}">
<script type="text/javascript" src="@{'/public/javascripts/jquery-2.0.0.min.js'}"></script>
<script type="text/javascript" src="@{'/public/javascripts/jquery.easyui.min.js'}"></script>
<script type="text/javascript" src="@{'/public/javascripts/easyui-lang-zh_CN.js'}"></script>
</head>
<body>
    <table id="datas" class="easyui-datagrid" style="border: false; width: auto; height: auto" data-options="pagination:true,singleSelect:true,url:'/admin/order/getUsers',method:'get',toolbar:'#tb'">
        <thead>
            <tr>
                <th data-options="field:'ck',checkbox:true"></th>
                <th data-options="field:'username',width:150,align:'center'">用户名</th>
                <th data-options="field:'email',width:130,align:'center'">邮箱</th>
                <th data-options="field:'sex',width:40,align:'center'">性别</th>
                <th data-options="field:'address',width:240,align:'center'">地址</th>
                <th data-options="field:'ordernum',width:60,align:'center'">订单数量</th>
                <th data-options="field:'others',width:200,align:'center'">备注</th>
            </tr>
        </thead>
    </table>
    <div id="tb" style="border: false; padding: 5px; height: auto">
        <div style="margin-bottom: 5px">
            <a id="add" class="easyui-linkbutton" iconCls="icon-add" plain="true"></a>
            <a id="edit" class="easyui-linkbutton" iconCls="icon-edit" plain="true"></a> 
            <a id="delete" class="easyui-linkbutton" iconCls="icon-remove" plain="true"></a>
            订单日期: <input id="startdate" class="easyui-datebox" style="width: 80px">
            至: <input id="enddate" class="easyui-datebox" style="width: 80px">
            <a id="query" class="easyui-linkbutton" iconCls="icon-search">查询</a>
        </div>
    </div>
    <div id="editdialog" style="padding:5px;width:600px;height:300px;top:100px" closed="true">
       #{form @AdminUsers.saveUser(), id:'dataform'}
            <table cellpadding="5">
                <tr>
                    <td>用户名：</td>
                    <td><input id="username" class="easyui-validatebox textbox" type="text" name="user.username" data-options="required:true" style="width:150px" /></td>
                    <td>邮箱:</td>
                    <td><input id="email" type="text" name="user.email" data-options="required:true" style="width:150px"></td>
                </tr>
                <tr>
                    <td>真实姓名</td>
                    <td><input id="realname" class="easyui-validatebox textbox" type="text" name="user.realname" data-options="required:true" style="width:150px" /></td>
                    <td>性别:</td>
                    <td><input class="easyui-validatebox textbox" type="text" name="user.userDetail.sex" data-options="required:true" style="width:150px"></input></td>
                </tr>
                <tr>
                    <td>地址：</td>
                    <td><input class="easyui-validatebox textbox" type="text" name="user.userDetail.address[0].address" data-options="required:true" style="width:150px"></input></td>
                    <td>电话:</td>
                    <td><input class="easyui-validatebox textbox" type="text" name="user.userDetail.address[0].phone" data-options="required:true" style="width:150px"></input></td>
                </tr>
            </table>
        #{/form}
    </div> 
    <script type="text/javascript">
        $("#add").click(function() {
            $('#editdialog').dialog('open');
        });
        
        $("#edit").click(function() {
            var rows = $('#datas').datagrid('getSelections');
            if (rows.length == 0) {
                alert("请先选择需要编辑的条目！")
            }
            var id = "id=" + rows[0].id;
            $.ajax({
                url:'/admin/user/getUserInfo',  
                type:'GET',
                data:id,
                success:function(data){
                    var obj = JSON.parse(data);
                    $('#dataform').form('load',{
                    	'user.username':obj.username,
                    	'user.email':obj.email
                    });
                    $("#editdialog").dialog("open");
                    
                },  
                error:function() {  
                    alert("编辑失败，请重试！");  
                }  
            });
        });
    
        $("#delete").click(function() {
            var rows = $('#datas').datagrid('getSelections');
            var ids = "";
            for(var i=0; i<rows.length; i++){
                ids += "id="+ rows[i].id
                if (i != rows.length - 1) {
                    ids+="&"
                }
            }
            
            $.ajax({
                url:'/admin/user/deleteUser',  
                type:'POST',
                data:ids,  
                success:function(data){  
                    $("#editdialog").dialog("close");
                    $("#datas").datagrid("reload");
                    alert("删除成功！");
                },  
                error:function(){  
                    alert("删除失败，请重试！");  
                }  
            });
        });
        
        $("#query").click(function() {
            startdate=$('#startdate').datebox("getValue");
            enddate=$('#enddate').datebox("getValue");
            $('#datas').datagrid('load', { 
                startdate: startdate,
                enddate: enddate 
            });
        });
        
        $('#editdialog').dialog({
            title : '订单编辑',
            buttons : [
            {
                text : '保存',
                iconCls : 'icon-save',
                handler : function() {
//                  $('#orderform').submit();
                    var form = $("#dataform"); 
                    $.ajax({  
                        url:form.attr('action'),  
                        type:form.attr('method'),  
                        data:form.serialize(),  
                        success:function(data){  
                            $("#editdialog").dialog("close");
                            $("#datas").datagrid("reload");
                            alert("提交成功！");
                        },  
                        error:function(){  
                            alert("提交失败，请重试！");  
                        }  
                    });
                }
            }, {
                text : '取消',
                iconCls : 'icon-cancel',
                handler : function() {
                    $('#editdialog').dialog('close');
                }
            }]
        });
        
        
    </script>
</body>
</html>